# Автоматизированная обработка PDF-документов о штрафах

Этот проект представляет собой скрипт Python, автоматизирующий обработку PDF-документов о штрафах. Он выполняет скачивание файлов с OpenAI Диска, извлечение текстовой и числовой информации, распознавание номеров автомобилей, сохранение данных в CSV и отправку уведомлений по электронной почте.

## Описание проекта

Скрипт автоматизирует следующие процессы:

1.  **Скачивание PDF:** Загрузка PDF-файлов из папки, созданной в текущий день на OpenAI Диске, в локальную директорию.
2.  **Извлечение данных:** Анализ PDF-документов и извлечение информации о штрафах, включая:
    *   Номер постановления
    *   Сумму штрафа
    *   Дату и время нарушения
    *   Адрес нарушения
    *   Номер транспортного средства
    *   Номер СТС
    *   Дополнительные данные
3.  **Распознавание номеров:** Использование методов компьютерного зрения (EasyOCR, Tesseract) для распознавания номеров автомобилей на изображениях в PDF.
4.  **Формирование CSV:** Создание CSV-файла, содержащего все извлеченные данные, включая результаты распознавания номеров и флаги соответствия.
5.  **Отправка уведомлений:**
    *   Отправка сводной таблицы нарушений по адресам в формате Excel.
    *   Уведомления по email о несоответствии номеров и штрафах, превышающих заданную сумму.

## Технические требования

*   **Python 3.x**
*   **Python-библиотеки:**
    *   `google-api-python-client`
    *   `google-auth-httplib2`
    *   `google-auth-oauthlib`
    *   `pymupdf`
    *   `Pillow`
    *   `easyocr`
    *   `pandas`
    *   `opencv-python`
    *   `pdf2image`
    *   `pytesseract`
    *    `pdfplumber`
    *   `openpyxl`
    *   `yagmail`
*   **Системные утилиты (для Linux):**
    *   `poppler-utils`
    *   `tesseract-ocr`
    *   `libleptonica-dev`
    *   `tesseract-ocr-rus`

## Установка

1.  **Python:** Убедитесь, что у вас установлен Python 3.
2.  **Библиотеки Python:**
    ```bash
    pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib pymupdf Pillow easyocr pandas opencv-python pdf2image pytesseract pdfplumber openpyxl yagmail
    ```
3.  **Системные утилиты (Linux):**
    ```bash
    apt-get install -y poppler-utils
    apt-get remove tesseract-ocr
    apt-get install tesseract-ocr
    apt-get install -y libleptonica-dev
    apt-get install -y tesseract-ocr-rus
    ```

## Настройка

1.  **OpenAI Colab:** Запустите скрипт в среде OpenAI Colab для аутентификации через OpenAI Drive API.
2.  **Учетные данные email:** В коде замените заполнители на ваши реальные email-адреса и пароль отправителя (Gmail).
    *   `'ваш_email@gmail.com'`
    *   `'ваш_пароль'`
    *   **Важно:** Храните учетные данные в безопасности.
3.  **OpenAI Drive:** Убедитесь, что на вашем OpenAI Диске создана папка "Штрафы", содержащая папки с PDF файлами.

## Запуск

1.  Запустите скрипт в среде OpenAI Colab.
2.  Скрипт автоматически:
    *   Загрузит PDF-файлы.
    *   Извлечет данные.
    *   Распознает номера.
    *   Сохранит результаты в `violations_data.csv` в папке `/content/output`.
    *   Отправит уведомления по электронной почте.

## Выходные данные

*   **CSV-файл:** `violations_data.csv` в папке `/content/output` с извлеченными данными.
*   **Папки с изображениями:** Временные папки с изображениями из PDF (`/content/images`).
*   **Уведомления по email:** Отправка сводных таблиц и уведомлений.

## Особенности

*   **Логирование:**  Встроенная система логирования для отслеживания ошибок и хода выполнения.
*   **Обработка ошибок:**  Улучшенная обработка ошибок для стабильной работы.
*   **Нормализация данных:**  Приведение данных к единому формату.
*   **Компьютерное зрение:** Использование EasyOCR и Tesseract для распознавания номеров.
*   **Сравнение номеров:** Проверка соответствия номеров из текста и с изображений.
*   **Email-уведомления:**  Отправка уведомлений и сводных таблиц по электронной почте.
*   **Автоматизация:** Работает с PDF-файлами из папок, созданных в текущий день.

## Примечания

*   Скрипт разработан для PDF-документов определенного формата. В случае необходимости, может потребоваться корректировка кода.
*   Предназначен для работы в OpenAI Colab из-за зависимости от Google Drive API.
*   Проверьте правильность путей к файлам и папкам в коде перед запуском.
